services:
  gluetun:
    image: qmcgaw/gluetun:latest
    container_name: gluetun
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    environment:
      - VPN_SERVICE_PROVIDER=mullvad
      - VPN_TYPE=wireguard
      - WIREGUARD_PRIVATE_KEY=${MULLVAD_PRIVATE_KEY}
      - WIREGUARD_ADDRESSES=${MULLVAD_ADDRESSES}
      - SERVER_CITIES=${MULLVAD_SERVER_CITY}
      - TZ=Europe/Madrid
    ports:
      - "9696:9696"  # Prowlarr UI
      - "8191:8191"  # FlareSolverr
      - "8989:8989"  # Sonarr UI
      - "7878:7878"  # Radarr UI
      - "6767:6767"  # Bazarr UI
      - "8096:8096"  # Jellyfin UI
      - "6500:6500"  # RDTClient Real-Debrid
      - "6501:6501"  # RDTClient TorBox
    networks:
      - media_net
    restart: unless-stopped

  rdtclient-realdebrid:
    image: rogerfar/rdtclient:latest
    container_name: rdtclient-rd
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Madrid
    volumes:
      - ./rdtclient-rd/data:/data/db
      - /media/storage/media/downloads:/data/downloads
    network_mode: "service:gluetun"
    depends_on:
      - gluetun
    restart: unless-stopped
    labels:
      - homepage.group=Download Clients
      - homepage.name=Real-Debrid
      - homepage.icon=real-debrid.png
      - homepage.href=http://raspberrypi.local:6500
      - homepage.description=Real-Debrid Client

  rdtclient-torbox:
    image: rogerfar/rdtclient:latest
    container_name: rdtclient-torbox
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Madrid
    volumes:
      - ./rdtclient-torbox/data:/data/db
      - /media/storage/media/downloads:/data/downloads
      - ./rdtclient-torbox/appsettings.json:/app/appsettings.json
    network_mode: "service:gluetun"
    depends_on:
      - gluetun
    restart: unless-stopped
    labels:
      - homepage.group=Download Clients
      - homepage.name=TorBox
      - homepage.icon=torbox.png
      - homepage.href=http://raspberrypi.local:6501
      - homepage.description=TorBox Client

  flaresolverr:
    image: ghcr.io/flaresolverr/flaresolverr:latest
    container_name: flaresolverr
    environment:
      - LOG_LEVEL=info
      - TZ=Europe/Madrid
      - CAPTCHA_SOLVER=none
      - TIMEOUT=120000
    network_mode: "service:gluetun"
    depends_on:
      - gluetun
    restart: unless-stopped

  sonarr:
    image: lscr.io/linuxserver/sonarr:latest
    container_name: sonarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Madrid
    volumes:
      - ./sonarr:/config
      - /media/storage/media:/data
    network_mode: "service:gluetun"
    depends_on:
      - gluetun
      - rdtclient-realdebrid
      - rdtclient-torbox
    restart: unless-stopped
    labels:
      - homepage.group=Media Management
      - homepage.name=Sonarr
      - homepage.icon=sonarr.png
      - homepage.href=http://raspberrypi.local:8989
      - homepage.description=TV Shows
      - homepage.widget.type=sonarr
      - homepage.widget.url=http://sonarr:8989
      - homepage.widget.key=YOUR_SONARR_API_KEY

  radarr:
    image: lscr.io/linuxserver/radarr:latest
    container_name: radarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Madrid
    volumes:
      - ./radarr:/config
      - /media/storage/media:/data
    network_mode: "service:gluetun"
    depends_on:
      - gluetun
      - rdtclient-realdebrid
      - rdtclient-torbox
    restart: unless-stopped
    labels:
      - homepage.group=Media Management
      - homepage.name=Radarr
      - homepage.icon=radarr.png
      - homepage.href=http://raspberrypi.local:7878
      - homepage.description=Movies
      - homepage.widget.type=radarr
      - homepage.widget.url=http://radarr:7878
      - homepage.widget.key=YOUR_RADARR_API_KEY

  prowlarr:
    image: lscr.io/linuxserver/prowlarr:latest
    container_name: prowlarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Madrid
    volumes:
      - ./prowlarr:/config
    network_mode: "service:gluetun"
    depends_on:
      - gluetun
      - flaresolverr
    restart: unless-stopped
    labels:
      - homepage.group=Media Management
      - homepage.name=Prowlarr
      - homepage.icon=prowlarr.png
      - homepage.href=http://raspberrypi.local:9696
      - homepage.description=Indexer Manager
      - homepage.widget.type=prowlarr
      - homepage.widget.url=http://prowlarr:9696
      - homepage.widget.key=YOUR_PROWLARR_API_KEY

  bazarr:
    image: lscr.io/linuxserver/bazarr:latest
    container_name: bazarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Madrid
    volumes:
      - ./bazarr:/config
      - /media/storage/media:/data
    network_mode: "service:gluetun"
    depends_on:
      - gluetun
    restart: unless-stopped
    labels:
      - homepage.group=Media Management
      - homepage.name=Bazarr
      - homepage.icon=bazarr.png
      - homepage.href=http://raspberrypi.local:6767
      - homepage.description=Subtitles

  jellyfin:
    image: lscr.io/linuxserver/jellyfin:latest
    container_name: jellyfin
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Madrid
    volumes:
      - ./jellyfin:/config
      - /media/storage/media:/data
    network_mode: "service:gluetun"
    depends_on:
      - gluetun
    restart: unless-stopped
    labels:
      - homepage.group=Media Servers
      - homepage.name=Jellyfin
      - homepage.icon=jellyfin.png
      - homepage.href=http://raspberrypi.local:8096
      - homepage.description=Media Server
  homarr:
    image: ghcr.io/ajnart/homarr:latest
    container_name: homarr
    restart: unless-stopped
    ports:
      - "5000:7575"
    volumes:
      - ./homarr/configs:/app/data/configs
      - ./homarr/icons:/app/public/icons
      - ./homarr/data:/data
      - /var/run/docker.sock:/var/run/docker.sock:ro
    environment:
      - TZ=Europe/Madrid
    networks:
      - media_net

networks:
  media_net:
    driver: bridge
